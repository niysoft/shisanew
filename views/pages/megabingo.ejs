<!DOCTYPE html>
<html lang="en">
<meta http-equiv="content-type" content="text/html;charset=utf-8"/><!-- /Added by HTTrack -->
<head>
    <% include ../partials/header_.ejs %>
    <style>
        #pick_numbers_0, #pick_numbers_1, #pick_numbers_2 {
            text-align: center !important;
        }

        .timecount {
            font-weight: bold;
            font-size: 20px;
        }

        .pick-numbers {
            margin-right: 12px;
        }
        .show_ {
            height: 50px;
            width: 50px;
            border-radius: 25px;
            line-height: 50px;
            font-size: 34px;
        }

        .show_:first-child {
            margin-left: 40px;
        }
    </style>
</head>
<body class="">
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NKDMSK6" height="0" width="0"
            style="display:none;visibility:hidden"></iframe>
</noscript>
<div class="wrapper ">
    <% include ../partials/sidebar.ejs %>
    <div class="main-panel">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="navbar-toggler-icon icon-bar"></span>
                    <span class="navbar-toggler-icon icon-bar"></span>
                    <span class="navbar-toggler-icon icon-bar"></span>
                </button>
            </div>
        </nav>
        <div class="content" style="margin-top: 0">
            <div class="container-fluid">
                <button class="btn btn-rose" style="width:100%;text-align: left;font-size: 22px;text-transform: none;">
                    Mega Bingo Draw
                    <div class="ripple-container"></div>
                </button>
                <% include ../partials/stats.ejs %>
                <div class="row">
                    <div class="col-lg-6">
                        <div class="card" style="min-height: 680px;">
                            <div class="card-header card-header-text card-header-rose">
                                <div class="card-text">
                                    <h4 class="card-title"><b>How to Play MegaBingo/Winning Formula</b></h4>
                                </div>
                            </div>
                            <div class="card-body" style="min-height: 500px;">
                                <div class="tab-content tab-space">
                                    <div class="tab-pane active show" id="link3">
                                        Completely synergize resource taxing relationships via premier niche markets.
                                        Professionally cultivate one-to-one customer service with robust ideas.
                                        <br>
                                        <br>Dynamically innovate resource-leveling customer service for state of the art
                                        customer service.
                                        Collaboratively administrate empowered markets via plug-and-play networks.
                                        Dynamically procrastinate B2C users after installed base benefits.
                                        <br>
                                        <br> Dramatically visualize customer directed convergence without revolutionary
                                        ROI. Collaboratively administrate empowered markets via plug-and-play networks.
                                        Dynamically procrastinate B2C users after installed base benefits.
                                        <br>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header card-header-text card-header-rose">
                                <div class="card-text">
                                    <h4 class="card-title"><b>Play MegaBingo Draw</b></h4>
                                    <p class="card-category">Select 6 numbers and win. Simple!</p>
                                </div>
                            </div>
                            <div class="card-body">
                                <!--<form>-->
                                <div class="card" style="margin-top: 10px;">
                                    <div class="card-header card-header-danger card-header-icon"
                                         style="min-height: 60px;">
                                        <div class="card-icon" style="float: right;">
                                            <h4>Balance: &#8358;<span
                                                        class="accountBalance"><%= userData.data.accountBalanceF %></span>
                                            </h4>
                                        </div>
                                        <input type="number" readonly class="form-control" id="stakeAmount"
                                               rel="<%= userData.data.accountBalance %>"
                                               onkeyup="adjustBalance(this)" placeholder="Amount to play"
                                               style="float:left;width: 200px;height:40px">
                                    </div>
                                </div>
                                <div class="card">
                                    <div style="margin-bottom: -20px;padding: 20px;">
                                        Select your choice 6 number to play
                                        <hr style="margin-right:30px;margin-left: 30px">
                                    </div>
                                    <div class="card-body">
                                        <div style="float: left;width: 100%;">
                                            <div class="pick-numbers" rel="pick_numbers_0" >
                                                0
                                            </div>
                                            <button disabled id="autoselect" onclick="{autoSelect()}"
                                                    class="btn btn-fill btn-behance"
                                                    style="float: right;height: 28px;padding: 7px;margin: 0;margin-left: 10px;">
                                                Auto Pick
                                            </button>
                                            <a href="" disabled onclick="{$('.pick-numbers').removeClass('pick-numbers-color'); return false}"
                                               style="float: right;color:red;text-decoration: underline">
                                                Clear Selection
                                            </a>
                                        </div>
                                        <div style="padding:3px;border-radius: 5px;text-align: center;height: 50px;">
                                            <%
                                            for(var j = 1; j <= 36; j++) {
                                            %>
                                                <div class="pick-numbers" rel="pick_numbers_<%= j %>"> <%= j %></div>
                                            <% } %>
                                        </div>
                                    </div>
                                    <div class="card-footer ">
                                        <div class="row">
                                            <div class="col-md-9">
                                                <button type="submit" disabled
                                                        class="playBtn btn btn-fill btn-danger">Submit to Play!
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- </form>-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <% include ../partials/footer.ejs %>
    </div>
</div>
<% <!--include ../partials/theme_bar.ejs--> %>
<% include ../partials/footer_script.ejs %>
<!--<script src="https://unpkg.com/axios/dist/axios.min.js"></script>-->
<script>

    function autoSelect() {
        $(".pick-numbers").removeClass('pick-numbers-color')
        while ($('div.pick-numbers.pick-numbers-color').length < 6) {
            let index2 = Math.floor(Math.random() * (70 - 0 + 0)) + 0
            $(".pick-numbers:eq(" + index2 + ")").trigger("click")
            //console.log(index2)
        }
       /* for (let i = 0; i<7; i++){
            let index2 = Math.floor(Math.random() * (36 - 1 + 1)) + 1
            $(".pick-numbers:eq("+index2+")").trigger("click")
        }*/
    }

    function initializeGame() {
        $.unblockUI();
        $("#stakeAmount").removeAttr('readonly')
        $(".playBtn, #autoselect").removeAttr('disabled')//
        $('.pick-numbers').on('click', function () {
            if ($('div.pick-numbers-color').length < 6) {
                $(this).addClass('pick-numbers-color')
            }
        });
        $('.playBtn').on('click', function () {
            let pick = "";
            let pickSize = 0;
            let feedback = ""
            $('.pick-numbers-color').each(function () {
                let num = $.trim($(this).text())
                feedback += "<div class='pick-numbers pick-numbers-color show_'>" + num + "</div>"
                pick += num + ","
                pickSize++;
            })
            pick = pick.slice(0, -1)
            feedback = "<div style='text-align: center'>" + feedback + "</div>"
            console.log(feedback)
            let stakeAmount = parseFloat($('#stakeAmount').val())
            if (pickSize == 6 && !isNaN(stakeAmount) && stakeAmount >= 100) {
                playGame(getCookie("gameId"), getCookie("userId"), stakeAmount, pick, feedback);
                return false
            } else {
                showInvalidDetailsError("")
            }
        })
    }

    function playGame(gameId, playerId, stakeAmount, pick, feedback) {
        $.ajax({
            crossOrigin: true,
            crossDomain: true,
            method: "POST",
            url: ApiBaseUrl + "play_game",
            data: {gameType: 'MEGA_BINGO', gameId: gameId, playerId: playerId, stakeAmount: stakeAmount, pick: pick, spot:6},
            beforeSend: function (xhr) {
                $.blockUI({message: '<h3 style="text-transform:none;"><div class="lds-hourglass"></div><br>Processing...</h3>'});
            }
        }).done(function (responseText) {
            $.ajax({
                crossOrigin: true,
                crossDomain: true,
                method: "POST",
                url: ApiBaseUrl + "load_details",
                data: {accessToken: getCookie('accessToken')},
                beforeSend: function (xhr) {
                    $.blockUI({message: '<h3 style="text-transform:none;"><div class="lds-hourglass"></div><br>Processing...</h3>'});
                }
            }).done(function (responseText) {
                $.unblockUI()
                setCookie("userData", JSON.stringify(responseText))
                showSuccess(feedback)
            }).fail(function (jqXHR, exception) {
                let error_string = jqXHR.responseJSON.error_string
                md.showNotificationCustom('top', 'center', error_string)
                $.unblockUI()
            });
            //  console.log(responseText)

        }).fail(function (jqXHR, exception) {
            let error_string = jqXHR.responseJSON.error_string
            showInvalidDetailsError(error_string)
        });
    }


    function loadGame() {//
        let current_datetime = new Date()
        let current_date = current_datetime.getFullYear() + "-" + (current_datetime.getMonth() + 1) + "-" + current_datetime.getDate()
        $.ajax({
            crossOrigin: true,
            crossDomain: true,
            method: "POST",
            url: ApiBaseUrl + "load_games",
            data: {gameType: 'MEGA_BINGO', date: current_date, playerId: getCookie('userId')},
            beforeSend: function (xhr) {
                $.blockUI({message: '<h3 style="text-transform:none;"><div class="lds-hourglass"></div><br>Processing...</h3>'});
            }
        }).done(function (responseText) {
            setCookie("userId", responseText.data.user._id, 24)
            setCookie("gameId", responseText.data.games._id, 24)
            let d = new Date(); // for now
            let currentInSeconds = d.getSeconds() + d.getMinutes() * 60 + d.getHours() * 3600; // => 9
            let gameTime = responseText.data.games.gameTime
            let gameTimeInSecond = gameTime.minute * 60 + gameTime.hour * 3600
            let timePassedInSecond = currentInSeconds - gameTimeInSecond
            let gameDuration = gameTime.duration
            let remainingTimeInSecond = gameDuration - timePassedInSecond
            if (currentInSeconds > gameTimeInSecond) {//game open
                $("#closes_opens").text('Game Closes in')
                if (remainingTimeInSecond > 0) {//game still playable
                    remainingTimeInSecond += 3
                    makeTimer(remainingTimeInSecond);
                    initializeGame()
                } else {//game closed
                    $("#closes_opens").text("Today's Pick 3 Game is Closed")
                    $.unblockUI();
                }
            } else {//game yet to start
                $("#closes_opens").text('Game Opens in').css("color", "blue")
                $('.timecount').css("color", "blue")
                let timeRemainingtoOpen = gameTimeInSecond - currentInSeconds + 3
                makeTimer(timeRemainingtoOpen);
                $.unblockUI();
            }

        }).fail(function (jqXHR, exception) {
            let error_string = jqXHR.responseJSON.error_string
            md.showNotificationCustom('top', 'center', error_string)
            $.unblockUI()
        });
        return false;
    }

    $(document).ready(function () {
        loadGame()

    })
</script>
</body>
</html>
