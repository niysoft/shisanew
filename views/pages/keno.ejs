<!DOCTYPE html>
<html lang="en">
<meta http-equiv="content-type" content="text/html;charset=utf-8"/><!-- /Added by HTTrack -->
<head>
    <% include ../partials/header_.ejs %>
    <style>
        #pick_numbers_0, #pick_numbers_1, #pick_numbers_2 {
            text-align: center !important;
        }

        .timecount {
            font-weight: bold;
            font-size: 20px;
        }

        .pick-numbers, .pick_numbers_ {
            margin-right: 6px;
            margin-bottom: 6px;
            font-size: 14px;
            line-height: 28px;
            height: 28px;
            width: 28px;
            border-radius: 14px;
        }

        .ports {
            height: 32px;
            width: 52px;
            line-height: 32px;
            border-radius: 6px;
        }

        /*.ports:first-child{
            margin-left: 50px;
        }*/
        .show_ {
            height: 50px;
            width: 50px;
            border-radius: 25px;
            line-height: 50px;
            font-size: 34px;
        }

        .show_:first-child {
            margin-left: 90px;
        }
    </style>
</head>
<body class="">
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NKDMSK6" height="0" width="0"
            style="display:none;visibility:hidden"></iframe>
</noscript>
<div class="wrapper ">
    <% include ../partials/sidebar.ejs %>
    <div class="main-panel">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="navbar-toggler-icon icon-bar"></span>
                    <span class="navbar-toggler-icon icon-bar"></span>
                    <span class="navbar-toggler-icon icon-bar"></span>
                </button>
            </div>
        </nav>
        <div class="content" style="margin-top: 0">
            <div class="container-fluid">
                <button class="btn card-header-tumblr"
                        style="width:100%;text-align: left;font-size: 22px;text-transform: none;">
                    Keno Draw
                    <div class="ripple-container"></div>
                </button>
                <% include ../partials/stats.ejs %>
                <div class="row">
                    <div class="col-lg-6">
                        <div class="card" style="min-height: 720px;">
                            <div class="card-header card-header-text card-header-tumblr">
                                <div class="card-text">
                                    <h4 class="card-title"><b>How to Play Keno Draw/Winning Formula</b></h4>
                                </div>
                            </div>
                            <div class="card-body" style="min-height: 500px;">
                                <div class="tab-content tab-space">
                                    <div class="tab-pane active show" id="link3">
                                        Completely synergize resource taxing relationships via premier niche markets.
                                        Professionally cultivate one-to-one customer service with robust ideas.
                                        <br>
                                        <br>Dynamically innovate resource-leveling customer service for state of the art
                                        customer service.
                                        Collaboratively administrate empowered markets via plug-and-play networks.
                                        Dynamically procrastinate B2C users after installed base benefits.
                                        <br>
                                        <br> Dramatically visualize customer directed convergence without revolutionary
                                        ROI. Collaboratively administrate empowered markets via plug-and-play networks.
                                        Dynamically procrastinate B2C users after installed base benefits.
                                        <br>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header card-header-text card-header-tumblr">
                                <div class="card-text">
                                    <h4 class="card-title"><b>Play Keno Draw</b></h4>
                                    <p class="card-category">Select 5 numbers and win. Simple!</p>
                                </div>
                            </div>
                            <div class="card-body">
                                <!--<form>-->
                                <div class="card" style="margin-top: 10px;">
                                    <div class="card-header card-header-danger card-header-icon"
                                         style="min-height: 60px;">
                                        <div class="card-icon" style="float: right;">
                                            <h4>Balance: &#8358;<span
                                                        class="accountBalance"><%= userData.data.accountBalanceF %></span>
                                            </h4>
                                        </div>
                                        <input type="number" readonly class="form-control" id="stakeAmount"
                                               rel="<%= userData.data.accountBalance %>"
                                               onkeyup="adjustBalance(this)" placeholder="Amount to play"
                                               style="float:left;width: 200px;height:40px">
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-body">
                                        <div style="margin-bottom: -20px;padding:10px;">
                                            Choose KENO spots you want to match
                                            <hr style="margin-right:30px;">
                                        </div>
                                        <div style="padding:3px;border-radius: 5px;text-align: center;height: 50px;width:auto;text-align: center">
                                            <%
                                            for(var j = 1; j <= 6; j++) {
                                            %>
                                                <div class="pick_numbers_ ports keno-spots"
                                                     rel="pick_numbers_<%= j %>"><%= j %></div>
                                            <% } %>
                                        </div>
                                        <div style="float: left;width: 100%;">
                                            <div style="margin-bottom: -20px;padding:10px;">
                                                Select your choice 5 number to play
                                                <hr style="margin-right:30px;">
                                            </div>
                                            <button disabled id="autoselect" onclick="{autoSelect()}"
                                                    class="btn btn-fill btn-behance"
                                                    style="float: right;height: 28px;padding: 7px;margin: 0;margin-left: 10px;">
                                                Auto Pick
                                            </button>
                                            <a href=""
                                               onclick="{$('.pick-numbers').removeClass('pick-numbers-color'); return false}"
                                               style="float: right;color:red;text-decoration: underline">
                                                Clear Selection
                                            </a>
                                            <P>&nbsp</P>
                                        </div>
                                        <br>
                                        <div style="padding:3px;border-radius: 5px;text-align: center;height: 50px;margin-top: 20px">
                                            <%
                                            for(var j = 1; j <= 70; j++) {
                                            %>
                                                <div class="pick-numbers keno-games disabled"
                                                     rel="pick_numbers_<%= j %>"> <%= j %></div>
                                            <% } %>
                                        </div>
                                    </div>
                                    <div class="card-footer" style="margin-top: -20px">
                                        <div class="row">
                                            <div class="col-md-9">
                                                <button type="submit" disabled
                                                        class="playBtn btn btn-fill btn-danger">Submit to Play!
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <% include ../partials/footer.ejs %>
    </div>
</div>
<% include ../partials/footer_script.ejs %>
<script>
    let spot = 0

    function autoSelect() {
        $(".pick-numbers").removeClass('pick-numbers-color')
        let arr = {}
        while ($('div.pick-numbers.pick-numbers-color').length < spot) {
            let index2 = Math.floor(Math.random() * (70 - 0 + 0)) + 0
            $(".pick-numbers:eq(" + index2 + ")").trigger("click")
        }
    }

    function initializeGame() {
        $.unblockUI();
        $("#stakeAmount").removeAttr('readonly')
        $('.pick_numbers_').on('click', function () {
            $('div.pick-numbers-color.keno-games').removeClass('pick-numbers-color')
            $('.pick_numbers_').removeClass('pick-numbers-color')
            $(this).addClass('pick-numbers-color')
            spot = $(this).text().trim()
            //console.log(spot)
            $(".playBtn, #autoselect, .pick-numbers").removeAttr('disabled')
            $(".pick-numbers").removeClass('disabled')

            $('.pick-numbers').on('click', function () {
                if ($('div.pick-numbers-color.keno-games').length < spot) {
                    $(this).addClass('pick-numbers-color')
                }
            });
        });
        $('.playBtn').on('click', function () {
            let pick = "";
            let pickSize = 0;
            let feedback = ""
            $('.pick-numbers-color.keno-games').each(function () {
                let num = $.trim($(this).text())
                feedback += "<div class='pick-numbers pick-numbers-color show_'>" + num + "</div>"
                pick += num + ","
                pickSize++;
            })
            pick = pick.slice(0, -1)
            feedback = "<div style='text-align: center'>" + feedback + "</div>"
            console.log(feedback)
            let stakeAmount = parseFloat($('#stakeAmount').val())
            if (pickSize == 5 && !isNaN(stakeAmount) && stakeAmount >= 100) {
                playGame(getCookie("gameId"), getCookie("userId"), stakeAmount, pick, feedback, spot);
                return false
            } else {
                let error_string = 'Error! One or more error exist. Please select desired numbers correctly and retry'
                showInvalidDetailsError(error_string)
            }
        })
    }

    function playGame(gameId, playerId, stakeAmount, pick, feedback, spot) {
        $.ajax({
            crossOrigin: true,
            crossDomain: true,
            method: "POST",
            url: ApiBaseUrl + "play_game",
            data: {
                gameType: 'KENO',
                gameId: gameId,
                playerId: playerId,
                stakeAmount: stakeAmount,
                pick: pick,
                spot: spot
            },
            beforeSend: function (xhr) {
                $.blockUI({message: '<h3 style="text-transform:none;"><div class="lds-hourglass"></div><br>Processing...</h3>'});
            }
        }).done(function (responseText) {
            $.ajax({
                crossOrigin: true,
                crossDomain: true,
                method: "POST",
                url: ApiBaseUrl + "load_details",
                data: {accessToken: getCookie('accessToken')},
                beforeSend: function (xhr) {
                    $.blockUI({message: '<h3 style="text-transform:none;"><div class="lds-hourglass"></div><br>Processing...</h3>'});
                }
            }).done(function (responseText) {
                $.unblockUI()
                setCookie("userData", JSON.stringify(responseText))
                showSuccess(feedback)
            }).fail(function (jqXHR, exception) {
                let error_string = jqXHR.responseJSON.error_string
                showInvalidDetailsError(error_string)
            });
        }).fail(function (jqXHR, exception) {
            let error_string = jqXHR.responseJSON.error_string
            showInvalidDetailsError(error_string)
        });
    }


    function loadGame() {//
        let current_datetime = new Date()
        let current_date = current_datetime.getFullYear() + "-" + (current_datetime.getMonth() + 1) + "-" + current_datetime.getDate()
        $.ajax({
            crossOrigin: true,
            crossDomain: true,
            method: "POST",
            url: ApiBaseUrl + "load_games",
            data: {gameType: 'KENO', date: current_date, playerId: getCookie('userId')},
            beforeSend: function (xhr) {
                $.blockUI({message: '<h3 style="text-transform:none;"><div class="lds-hourglass"></div><br>Processing...</h3>'});
            }
        }).done(function (responseText) {
            setCookie("userId", responseText.data.user._id, 24)
            setCookie("gameId", responseText.data.games._id, 24)
            let d = new Date(); // for now
            let currentInSeconds = d.getSeconds() + d.getMinutes() * 60 + d.getHours() * 3600; // => 9
            let gameTime = responseText.data.games.gameTime
            let gameTimeInSecond = gameTime.minute * 60 + gameTime.hour * 3600
            let timePassedInSecond = currentInSeconds - gameTimeInSecond
            let gameDuration = gameTime.duration
            let remainingTimeInSecond = gameDuration - timePassedInSecond
            if (currentInSeconds > gameTimeInSecond) {//game open
                $("#closes_opens").html('Today\'s <b>Bingo Perm</b> is open. Game Closes in')
                if (remainingTimeInSecond > 0) {//game still playable
                    remainingTimeInSecond += 3
                    makeTimer(remainingTimeInSecond);
                    initializeGame()
                } else {//game closed
                    $("#closes_opens").html('Today\'s <b>Bingo Perm</b> is closed. Check back later')
                    $.unblockUI();
                }
            } else {//game yet to start
                $("#closes_opens").text('Game Opens in').css("color", "blue")
                $('.timecount').css("color", "blue")
                let timeRemainingtoOpen = gameTimeInSecond - currentInSeconds + 3
                makeTimer(timeRemainingtoOpen);
                $.unblockUI();
            }

        }).fail(function (jqXHR, exception) {
            let error_string = jqXHR.responseJSON.error_string
            showInvalidDetailsError(error_string)
        });
        return false;
    }

    $(document).ready(function () {
        loadGame()
    })
</script>
</body>
</html>
